import{r as m,j as e,S as H,x as v,A as J}from"./app-DcU-pHgi.js";import{G as K}from"./GuestLayout-DDJIFGtz.js";import{y as V,ad as _,ae as W,q as X,a4 as Z,E as ee,n as se,af as ae}from"./index-VRqsH7Np.js";import{q as re}from"./index-Di9WJGrQ.js";import{r as t}from"./index-D3gu5DKJ.js";import{M as te}from"./Modal-DBDAEaT5.js";import"./TextInput-DVTwl0cB.js";import"./Dropdown-BEzsTaq8.js";import"./iconBase-8fZdkZtg.js";import"./transition-C-BcvKEz.js";import"./index-BarBPuyi.js";import"./index-x9q-pVUo.js";import"./keyboard-BcSRVZMa.js";function ye({auth:ne,event:a,eventTypes:le,internalCategories:E,externalCategories:R,isAuthenticated:l,userData:i}){const[P,k]=m.useState(!1),[c,u]=m.useState([]),[C,f]=m.useState(!1),[S,d]=m.useState(""),[I,h]=m.useState(""),[p,w]=m.useState(!1),[B,T]=m.useState("in-person"),g=function(s=6){return Math.random().toString(36).substring(2,s+2)};m.useEffect(()=>{u(i&&l?[{id:g(),name:i.name,email:i.email,phone:i.phone||"",locale:i.locale||"",attendee_type:"member",attendance_mode:"in-person"}]:[{id:g(),name:"",email:"",phone:"",locale:"",attendee_type:"guest",attendance_mode:"in-person"}])},[i,l]);const U=s=>{const r=new Date(s),n={weekday:"long",year:"numeric",month:"long",day:"numeric"};return r.toLocaleDateString("en-US",n)},F=s=>new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),A=s=>s?{...E,...R}[s]||s.replace("_"," "):"",L=()=>{u([...c,{id:g(),name:"",email:"",phone:"",locale:"",attendee_type:"guest",attendance_mode:"in-person"}])},G=s=>{u(c.filter(r=>r.id!==s))},Q=()=>{if(l&&a.is_internal&&!a.requires_registration){b();return}k(!0)},b=async()=>{if(!l){d("You must be logged in to check in."),h("error");return}if(a.has_attended){d("You have already checked in to this event."),h("error");return}w(!0);try{const r=await(await fetch(route("event.quick.check.in"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({event_id:a.id,attendance_mode:B})})).json();r.success?(d(r.message),h("success"),a.has_attended=!0,a.attendances_count+=1):(d(r.message||"Failed to check in. Please try again."),h("error"))}catch(s){console.error("Error during quick check-in:",s),d("An error occurred during check-in. Please try again."),h("error")}finally{w(!1)}},j=()=>{k(!1),u(i&&l?[{id:g(),name:i.name,email:i.email,phone:i.phone||"",locale:i.locale||"",attendee_type:"member",attendance_mode:"in-person"}]:[{id:g(),name:"",email:"",phone:"",locale:"",attendee_type:"guest",attendance_mode:"in-person"}])},x=(s,r,n)=>{u(c.map(N=>N.id===s?{...N,[r]:n}:N))},$=()=>{let s=!0;return c.forEach(r=>{(!r.name||!r.email||!r.phone)&&(s=!1),r.email&&!/\S+@\S+\.\S+/.test(r.email)&&(s=!1)}),s},D=async s=>{if(s.preventDefault(),!$()){alert("Please fill in all required fields with valid information.");return}f(!0);try{const r=await J.post(route("event.attendence.store"),{event_id:a.id,attendenceRows:c});f(!1),j(),d("Successfully registered for the event!"),h("success"),l&&(a.has_attended=!0),a.attendances_count+=c.length}catch(r){f(!1),console.error("Error registering attendance:",r),d("Failed to register attendance. Please try again."),h("error")}},Y=async()=>{const s=route("events.share",a.id);if(navigator.share)try{await navigator.share({title:a.title,text:a.description,url:s})}catch(r){console.error("Error sharing:",r),M(s)}else M(s)},M=s=>{navigator.clipboard.writeText(s).then(()=>{alert("Link copied to clipboard!")}).catch(r=>{console.error("Failed to copy: ",r)})},y=new Date,q=new Date(a.start_date),z=new Date(a.end_date);let o,O=!1;return y<q?(o="Upcoming",O=!0):y>=q&&y<=z?o="Ongoing":o="Past",e.jsxs(K,{children:[e.jsx(H,{title:a.title}),S&&e.jsxs("div",{className:`fixed top-20 right-4 z-50 w-80 p-4 rounded-lg shadow-lg transition-opacity duration-500 
                    ${I==="success"?"bg-green-500":"bg-red-500"} text-white`,children:[e.jsx("p",{children:S}),e.jsx("button",{className:"absolute top-2 right-2 text-white",onClick:()=>d(""),children:"Ã—"})]}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:[a.featured_image&&e.jsx("div",{className:"w-full h-72 bg-cover bg-center",style:{backgroundImage:`url(${a.featured_image})`},children:e.jsx("div",{className:"w-full h-full bg-black bg-opacity-50 flex items-end",children:e.jsxs("div",{className:"p-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-white",children:a.title}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx(t.Badge,{color:a.is_internal?"blue":"green",className:"mr-2",children:a.is_internal?"Members Only":"Open to Guests"}),e.jsx(t.Badge,{color:o==="Upcoming"?"blue":o==="Ongoing"?"green":"gray",children:o})]})]})})}),e.jsxs("div",{className:"p-6",children:[e.jsxs(v,{href:route("events.index"),className:"inline-flex items-center text-blue-600 hover:underline mb-6",children:[e.jsx(V,{className:"mr-2"}),"Back to all events"]}),!a.featured_image&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:a.title}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx(t.Badge,{color:a.is_internal?"blue":"green",className:"mr-2",children:a.is_internal?"Members Only":"Open to Guests"}),e.jsx(t.Badge,{color:o==="Upcoming"?"blue":o==="Ongoing"?"green":"gray",children:o})]})]}),!l&&a.requires_registration&&e.jsxs("div",{className:"bg-primary/10 border border-primary/20 p-6 rounded-lg mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary mb-2",children:"Registration Required"}),e.jsx("p",{className:"mb-4",children:"This event requires registration. Please sign in or create an account to register for this event."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(v,{href:route("login",{event_message:"Please log in to register for this event"}),className:"bg-primary text-white px-4 py-2 rounded-md inline-flex items-center hover:bg-primary/90 transition-all",children:e.jsx("span",{children:"Sign In"})}),e.jsx(v,{href:route("register"),className:"bg-gray-100 text-gray-800 px-4 py-2 rounded-md inline-flex items-center hover:bg-gray-200 transition-all",children:e.jsx("span",{children:"Register"})})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"w-full md:w-2/3 pr-0 md:pr-6",children:[e.jsx("div",{className:"prose max-w-none",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:a.description}})}),e.jsxs("div",{className:"mt-8 flex flex-wrap gap-4",children:[O&&!a.has_attended&&e.jsx(e.Fragment,{children:l&&a.is_internal&&!a.requires_registration?e.jsx("div",{children:e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs(t.Button,{color:"blue",onClick:()=>{T("in-person"),b()},disabled:p,className:"flex items-center gap-2",children:[e.jsx(_,{}),p?"Checking in...":"Check in (In-Person)"]}),e.jsxs(t.Button,{color:"purple",onClick:()=>{T("online"),b()},disabled:p,className:"flex items-center gap-2",children:[e.jsx(_,{}),p?"Checking in...":"Check in (Online)"]})]}),e.jsx(t.Typography,{variant:"small",className:"font-normal text-gray-600",children:"Quick check-in for members"})]})}):e.jsxs(t.Button,{color:"blue",onClick:Q,className:"flex items-center gap-2",children:[e.jsx(_,{}),a.requires_registration?"Register":"Check in"]})}),e.jsxs(t.Button,{variant:"outlined",color:"blue-gray",onClick:Y,className:"flex items-center gap-2",children:[e.jsx(W,{}),"Share Event"]})]})]}),e.jsx("div",{className:"w-full md:w-1/3 mt-6 md:mt-0",children:e.jsx(t.Card,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full mr-3",children:e.jsx(X,{className:"text-blue-500"})}),e.jsxs("div",{children:[e.jsx(t.Typography,{variant:"h6",color:"blue-gray",children:"Date"}),e.jsx(t.Typography,{variant:"small",className:"font-normal",children:U(a.start_date)})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full mr-3",children:e.jsx(Z,{className:"text-blue-500"})}),e.jsxs("div",{children:[e.jsx(t.Typography,{variant:"h6",color:"blue-gray",children:"Time"}),e.jsxs(t.Typography,{variant:"small",className:"font-normal",children:[F(a.start_date)," - ",F(a.end_date)]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full mr-3",children:e.jsx(ee,{className:"text-blue-500"})}),e.jsxs("div",{children:[e.jsx(t.Typography,{variant:"h6",color:"blue-gray",children:"Location"}),e.jsx(t.Typography,{variant:"small",className:"font-normal",children:a.location})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full mr-3",children:e.jsx(re,{className:"text-blue-500"})}),e.jsxs("div",{children:[e.jsx(t.Typography,{variant:"h6",color:"blue-gray",children:"Category"}),e.jsx(t.Typography,{variant:"small",className:"font-normal",children:A(a.category)})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full mr-3",children:e.jsx(se,{className:"text-blue-500"})}),e.jsxs("div",{children:[e.jsx(t.Typography,{variant:"h6",color:"blue-gray",children:"Attendees"}),e.jsxs(t.Typography,{variant:"small",className:"font-normal",children:[a.attendances_count," registered",a.max_attendees>0&&` (max: ${a.max_attendees})`]})]})]})]})})})]})]})]})})}),e.jsx(te,{show:P,onClose:j,maxWidth:"md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:a.requires_registration?"Register for Event":"Check in to Event"}),e.jsxs("form",{onSubmit:D,children:[c.map((s,r)=>e.jsxs("div",{className:"mb-6 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h3",{className:"text-md font-semibold",children:["Attendee #",r+1]}),c.length>1&&e.jsx("button",{type:"button",onClick:()=>G(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(FaTrash,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name*"}),e.jsx("input",{type:"text",value:s.name,onChange:n=>x(s.id,"name",n.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",required:!0,readOnly:l&&s.attendee_type==="member"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email*"}),e.jsx("input",{type:"email",value:s.email,onChange:n=>x(s.id,"email",n.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",required:!0,readOnly:l&&s.attendee_type==="member"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone*"}),e.jsx("input",{type:"tel",value:s.phone,onChange:n=>x(s.id,"phone",n.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",required:!0,readOnly:l&&s.attendee_type==="member"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Locale/Region*"}),e.jsx("input",{type:"text",value:s.locale,onChange:n=>x(s.id,"locale",n.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",required:!0,readOnly:l&&s.attendee_type==="member"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Attendee Type"}),e.jsxs("select",{value:s.attendee_type,onChange:n=>x(s.id,"attendee_type",n.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",disabled:l&&r===0,children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"guest",children:"Guest"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Attendance Mode"}),e.jsxs("select",{value:s.attendance_mode,onChange:n=>x(s.id,"attendance_mode",n.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"in-person",children:"In-Person"}),e.jsx("option",{value:"online",children:"Online"})]})]})]})]},s.id)),a.requires_registration&&e.jsx("div",{className:"mb-4",children:e.jsxs("button",{type:"button",onClick:L,className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(FaPlus,{className:"mr-1"})," Add Another Attendee"]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:j,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 flex items-center",disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(t.Spinner,{className:"mr-2 h-4 w-4"})," Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2"})," Submit"]})})]})]})]})})]})}export{ye as default};
