import{r as t,j as e,S as F}from"./app-CCsYImbS.js";import{A as D}from"./AdminLayout-COT21yrB.js";import{r as s}from"./index-BWzXBwXz.js";import{i as P,j as z,k as R,l as G,m as Q}from"./index-BdDt_jZi.js";import{f as b}from"./index-Dw_W2KWe.js";import"./index-BarBPuyi.js";import"./index-9ALxRgoG.js";import"./iconBase-DsVmA3m-.js";function X({event:r,attendances:C,flash:f}){const[i,w]=t.useState(""),[h,T]=t.useState("all"),[m,A]=t.useState("all"),[l,d]=t.useState(C),[p,x]=t.useState(!1),[y,g]=t.useState(!1),[N,S]=t.useState(null),[v,j]=t.useState(!1),[_,u]=t.useState(!1),k=l.filter(a=>{const n=i===""||a.name.toLowerCase().includes(i.toLowerCase())||a.email&&a.email.toLowerCase().includes(i.toLowerCase())||a.phone&&a.phone.toLowerCase().includes(i.toLowerCase()),o=h==="all"||a.attendee_type===h,O=m==="all"||a.attendance_mode===m;return n&&o&&O}),c={total:l.length,members:l.filter(a=>a.attendee_type==="member").length,guests:l.filter(a=>a.attendee_type==="guest").length,inPerson:l.filter(a=>a.attendance_mode==="in-person").length,online:l.filter(a=>a.attendance_mode==="online").length,checkedIn:l.filter(a=>a.check_in_time).length},M=a=>{confirm("Are you sure you want to check in this attendee?")&&(j(!0),router.post(route("admin.events.check-in",{event_id:r.id,attendance_id:a}),{},{onSuccess:()=>{j(!1),d(n=>n.map(o=>o.id===a?{...o,check_in_time:new Date().toISOString()}:o))},onError:()=>{j(!1),alert("Error checking in attendee")}}))},I=a=>{confirm("Are you sure you want to delete this attendance record?")&&(u(!0),router.delete(route("admin.events.delete-attendance",{event_id:r.id,attendance_id:a}),{onSuccess:()=>{u(!1),d(n=>n.filter(o=>o.id!==a))},onError:()=>{u(!1),alert("Error deleting attendance record")}}))},B=a=>{S(a),g(!0)},E=a=>{switch(a){case"member":return"blue";case"guest":return"green";default:return"gray"}},L=a=>{switch(a){case"in-person":return"indigo";case"online":return"purple";default:return"gray"}};return e.jsxs(D,{children:[e.jsx(F,{title:`Attendances - ${r.title}`}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[f.message&&e.jsx("div",{className:"mb-6 p-4 bg-green-100 text-green-700 rounded-lg",children:f.message}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Attendances: ",r.title]}),e.jsxs("p",{className:"text-gray-600",children:[b(new Date(r.start_date),"MMMM dd, yyyy")," at ",b(new Date(r.start_date),"h:mm a")]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 md:mt-0",children:[e.jsxs(s.Button,{onClick:()=>router.get(route("admin.events.export",r.id)),className:"flex items-center gap-2",color:"blue-gray",children:[e.jsx(P,{className:"h-4 w-4"}),"Export CSV"]}),e.jsxs(s.Button,{onClick:()=>x(!0),className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Add Attendee"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4 mb-6",children:[e.jsx(s.Card,{children:e.jsxs(s.CardBody,{className:"p-4 text-center",children:[e.jsx(s.Typography,{variant:"h6",color:"blue-gray",children:"Total"}),e.jsx(s.Typography,{variant:"h4",children:c.total})]})}),e.jsx(s.Card,{children:e.jsxs(s.CardBody,{className:"p-4 text-center",children:[e.jsx(s.Typography,{variant:"h6",color:"blue",children:"Members"}),e.jsx(s.Typography,{variant:"h4",children:c.members})]})}),e.jsx(s.Card,{children:e.jsxs(s.CardBody,{className:"p-4 text-center",children:[e.jsx(s.Typography,{variant:"h6",color:"green",children:"Guests"}),e.jsx(s.Typography,{variant:"h4",children:c.guests})]})}),e.jsx(s.Card,{children:e.jsxs(s.CardBody,{className:"p-4 text-center",children:[e.jsx(s.Typography,{variant:"h6",color:"indigo",children:"In-Person"}),e.jsx(s.Typography,{variant:"h4",children:c.inPerson})]})}),e.jsx(s.Card,{children:e.jsxs(s.CardBody,{className:"p-4 text-center",children:[e.jsx(s.Typography,{variant:"h6",color:"purple",children:"Online"}),e.jsx(s.Typography,{variant:"h4",children:c.online})]})}),e.jsx(s.Card,{children:e.jsxs(s.CardBody,{className:"p-4 text-center",children:[e.jsx(s.Typography,{variant:"h6",color:"gray",children:"Checked In"}),e.jsx(s.Typography,{variant:"h4",children:c.checkedIn})]})})]}),e.jsxs(s.Card,{className:"mb-8",children:[e.jsx(s.CardHeader,{floated:!1,shadow:!1,className:"rounded-none",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 md:px-4",children:[e.jsx("div",{className:"w-full md:w-72",children:e.jsx(s.Input,{label:"Search attendees",icon:e.jsx(R,{}),value:i,onChange:a=>w(a.target.value)})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("div",{className:"w-48",children:e.jsxs(Select,{label:"Attendee Type",value:h,onChange:a=>T(a),children:[e.jsx(Option,{value:"all",children:"All Types"}),e.jsx(Option,{value:"member",children:"Members"}),e.jsx(Option,{value:"guest",children:"Guests"})]})}),e.jsx("div",{className:"w-48",children:e.jsxs(Select,{label:"Attendance Mode",value:m,onChange:a=>A(a),children:[e.jsx(Option,{value:"all",children:"All Modes"}),e.jsx(Option,{value:"in-person",children:"In-Person"}),e.jsx(Option,{value:"online",children:"Online"})]})})]})]})}),e.jsx(s.CardBody,{className:"px-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-max table-auto text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-b border-gray-100 bg-gray-50/50 p-4",children:e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"font-normal leading-none opacity-70",children:"Name"})}),e.jsx("th",{className:"border-b border-gray-100 bg-gray-50/50 p-4",children:e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"font-normal leading-none opacity-70",children:"Contact"})}),e.jsx("th",{className:"border-b border-gray-100 bg-gray-50/50 p-4",children:e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"font-normal leading-none opacity-70",children:"Type"})}),e.jsx("th",{className:"border-b border-gray-100 bg-gray-50/50 p-4",children:e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"font-normal leading-none opacity-70",children:"Mode"})}),e.jsx("th",{className:"border-b border-gray-100 bg-gray-50/50 p-4",children:e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"font-normal leading-none opacity-70",children:"Check-In Status"})}),e.jsx("th",{className:"border-b border-gray-100 bg-gray-50/50 p-4",children:e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"font-normal leading-none opacity-70",children:"Notes"})}),e.jsx("th",{className:"border-b border-gray-100 bg-gray-50/50 p-4",children:e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"font-normal leading-none opacity-70",children:"Actions"})})]})}),e.jsx("tbody",{children:k.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{className:"p-4",children:[e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"font-medium",children:a.name}),a.user_id&&e.jsx(s.Badge,{color:"blue",size:"sm",className:"mt-1",children:"Registered User"})]}),e.jsxs("td",{className:"p-4",children:[a.email&&e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"font-normal",children:a.email}),a.phone&&e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"font-normal opacity-70",children:a.phone}),a.locale&&e.jsxs(s.Typography,{variant:"small",color:"blue-gray",className:"font-normal opacity-70",children:["Locale: ",a.locale]})]}),e.jsx("td",{className:"p-4",children:e.jsx(s.Badge,{color:E(a.attendee_type),className:"capitalize",children:a.attendee_type})}),e.jsx("td",{className:"p-4",children:e.jsx(s.Badge,{color:L(a.attendance_mode),className:"capitalize",children:a.attendance_mode})}),e.jsx("td",{className:"p-4",children:a.check_in_time?e.jsxs(e.Fragment,{children:[e.jsx(s.Badge,{color:"green",children:"Checked In"}),e.jsx(s.Typography,{variant:"small",className:"mt-1 opacity-70",children:b(new Date(a.check_in_time),"MMM d, h:mm a")})]}):a.attendance_mode==="in-person"?e.jsx(s.Button,{size:"sm",color:"blue",onClick:()=>M(a.id),disabled:v,children:v?"Processing...":"Check In"}):e.jsx(s.Badge,{color:"gray",children:"No Check-In Required"})}),e.jsx("td",{className:"p-4",children:e.jsx(s.Typography,{variant:"small",className:"opacity-70",children:a.notes||"â€”"})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.Tooltip,{content:"Edit Attendance",children:e.jsx(s.IconButton,{variant:"text",color:"blue",onClick:()=>B(a),children:e.jsx(G,{className:"h-4 w-4"})})}),e.jsx(s.Tooltip,{content:"Delete Attendance",children:e.jsx(s.IconButton,{variant:"text",color:"red",onClick:()=>I(a.id),disabled:_,children:e.jsx(Q,{className:"h-4 w-4"})})})]})})]},a.id))})]})})})]})]}),p&&e.jsx(AddAttendanceModal,{eventId:r.id,open:p,handleOpen:()=>x(!p),onSuccess:a=>{d([...l,a]),x(!1)}}),y&&N&&e.jsx(EditAttendanceModal,{eventId:r.id,attendance:N,open:y,handleOpen:()=>g(!y),onSuccess:a=>{d(l.map(n=>n.id===a.id?a:n)),g(!1)}})]})}export{X as default};
