import{X as Z,r as p,G as ee,j as e,S as se,x as P}from"./app-CCsYImbS.js";import{C as T}from"./Checkbox-B3akzzc0.js";import{I as te}from"./InputError-C_5yhjb2.js";import{I as N}from"./InputLabel-G3enCeXn.js";import{M as $}from"./Modal-1cPN2o8I.js";import{T as ie}from"./TextInput-CZlA3hAe.js";import{A as oe,i as le}from"./AuthenticatedLayout-C3jBRaOG.js";import{r as l}from"./index-BWzXBwXz.js";import{a as ae,b as ne,c as re,d as ce,R as A}from"./index-Cgxvnmok.js";import{O as de,V as x}from"./index-BkHnx_rv.js";import"./transition-DNCcSepB.js";import"./keyboard-BxwWZbOK.js";import"./index-LT8Lyk0a.js";import"./iconBase-DsVmA3m-.js";import"./Dropdown-CI9TtJWS.js";import"./index-BarBPuyi.js";import"./index-9ALxRgoG.js";function _e({auth:v,roles:h}){const{role:B,permissions:D}=Z().props.auth,L=["SN","Role Name","Permissions","Actions"],[M,f]=p.useState(!1),[F,E]=p.useState(!1),[I,y]=p.useState(""),[m,b]=p.useState(""),[w,k]=p.useState(""),[z,V]=p.useState({}),{data:r,setData:d,post:_,processing:S,errors:U,reset:u,delete:W}=ee({name:"",permissions:[]}),j=[{name:"Blog Posts",items:["create","edit","delete"]},{name:"Categories",items:["create","edit","delete"]},{name:"Tags",items:["create","edit","delete"]},{name:"Events",items:["create","edit","delete"]},{name:"Users",items:["create","edit","delete"]},{name:"Locale",items:["create","edit","delete"]},{name:"Church Locations",items:["create","edit","delete"]},{name:"Albums",items:["create","edit","delete"]},{name:"Email Templates",items:["create","edit","delete"]},{name:"Roles",items:["create","edit","delete"]},{name:"Banners",items:["create","edit","delete"]},{name:"Event Forms",items:["create","edit","delete"]}],O=s=>{V(o=>({...o,[s]:!o[s]}))},C=(s,o=0)=>{if(o!==0&&k(o),s==="add")y("Add New"),b("_add"),u();else if(s==="view"){const i=h.filter(t=>t.id===o);d({...i[0]}),y("View"),b("_view")}else if(s==="edit"){const i=h.filter(t=>t.id===o);d({...i[0]}),y("Edit"),b("_edit")}f(!0)},R=()=>{f(!1),u()},G=s=>{const{checked:o,value:i}=s.target;if(o){const t=r.permissions;d("permissions",[...t,i])}else{const t=r.permissions.filter(a=>a!==i);d("permissions",t)}},H=(s,o)=>{const i=j.find(t=>t.name===s).items.map(t=>`${t}_${s.toLowerCase().replace(/ /g,"_")}`);if(o){const t=[...r.permissions];i.forEach(a=>{t.includes(a)||t.push(a)}),d("permissions",t)}else{const t=r.permissions.filter(a=>!i.includes(a));d("permissions",t)}},X=s=>j.find(i=>i.name===s).items.map(i=>`${i}_${s.toLowerCase().replace(/ /g,"_")}`).every(i=>r.permissions.includes(i)),q=s=>{const o=j.find(t=>t.name===s).items.map(t=>`${t}_${s.toLowerCase().replace(/ /g,"_")}`),i=o.filter(t=>r.permissions.includes(t)).length;return i>0&&i<o.length},J=s=>{s.preventDefault(),m==="_add"?_(route("admin.roles.store"),{preserveScroll:!0,onSuccess:()=>{u(),f(!1),x.success("Role created successfully!")},onError:()=>{x.error("Failed to create role. Please check the form for errors.")}}):m==="_edit"&&_(route("admin.roles.update",w),{onSuccess:()=>{u(),f(!1),x.success("Role updated successfully!")},onError:()=>{x.error("Failed to update role. Please check the form for errors.")}})},K=s=>{k(s),E(!0)},g=()=>{E(!1)},Q=()=>{w&&W(route("admin.roles.delete",w),{onSuccess:()=>{g(),x.success("Role deleted successfully!")},onError:()=>{x.error("Failed to delete role.")}})},Y=s=>{if(!s||s.length===0)return"No permissions assigned";const o={};return s.forEach(i=>{const t=i.split("_"),a=t[0],c=t.slice(1).join("_");o[c]||(o[c]=[]),o[c].push(a)}),Object.entries(o).map(([i,t])=>`${i.replace(/_/g," ")} (${t.join(", ")})`).join("; ")};return e.jsxs(oe,{user:v==null?void 0:v.user,children:[e.jsx(se,{title:"Roles & Permissions"}),e.jsx(de,{position:"top-right"}),e.jsxs("div",{className:"content py-4 font-poppins",children:[e.jsxs("div",{className:"content-header px-6 flex justify-between items-center",children:[e.jsxs("div",{className:"left",children:[e.jsx("h1",{className:"font-semibold text-gray-800 text-3xl",children:"Role Management"}),e.jsx("div",{className:"pt-2",children:e.jsxs("ul",{className:"flex gap-1 text-gray-600 text-sm",children:[e.jsx("li",{children:e.jsx(P,{href:route("dashboard"),children:"Dashboard"})}),e.jsx("li",{children:"/"}),e.jsx("li",{children:e.jsx(P,{href:route("admin.roles.index"),children:"Roles"})})]})})]}),e.jsx("div",{className:"right",children:e.jsx(l.Button,{className:"bg-[#f5cd06] shadow-lg text-[#0f0f0f] px-5 py-3 rounded-md font-semibold text-lg font-poppins normal-case flex items-center gap-2",onClick:()=>{C("add")},children:e.jsx("span",{children:"Add New Role"})})})]}),e.jsx("div",{className:"page-content pt-6",children:e.jsx("div",{className:"bg-white rounded-lg shadow-md mx-6 p-4",children:e.jsxs(l.Card,{className:"h-full w-full overflow-hidden rounded-lg border border-gray-200 font-poppins shadow-none",children:[e.jsxs("table",{className:"w-full min-w-max table-auto text-left font-poppins",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:L.map(s=>e.jsx("th",{className:"border-b border-blue-gray-100 p-4",children:e.jsx(l.Typography,{className:"font-semibold text-sm leading-none opacity-70 font-poppins",children:s})},s))})}),e.jsx("tbody",{children:h.map(({id:s,name:o,permissions:i},t)=>{const n=t===h.length-1?"p-4":"p-4 border-b border-blue-gray-50",c=z[s]||!1;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:n,children:e.jsx(l.Typography,{className:"font-medium font-poppins text-sm",children:`${t+1}`})}),e.jsx("td",{className:n,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"text-yellow-600"}),e.jsx(l.Typography,{className:"font-medium font-poppins text-sm",children:`${o}`})]})}),e.jsx("td",{className:n,children:e.jsx("div",{className:"max-w-md",children:i&&i.length>0?e.jsxs(e.Fragment,{children:[e.jsx(l.Typography,{className:"font-medium font-poppins text-sm line-clamp-1",children:c?Y(i):`${i.length} permissions assigned`}),e.jsx(l.Button,{variant:"text",size:"sm",className:"p-0 mt-1",onClick:()=>O(s),children:c?"Collapse":"Show details"})]}):e.jsx(l.Typography,{className:"font-medium font-poppins text-sm text-gray-500",children:"No permissions assigned"})})}),e.jsx("td",{className:n,children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l.Tooltip,{content:"View Role Details",children:e.jsxs(l.Button,{size:"sm",variant:"text",className:"flex items-center gap-1 text-blue-500 p-1",onClick:()=>{C("view",s)},children:[e.jsx(ne,{})," View"]})}),e.jsx(l.Tooltip,{content:"Edit Role",children:e.jsxs(l.Button,{size:"sm",variant:"text",className:"flex items-center gap-1 text-blue-500 p-1",onClick:()=>{C("edit",s)},children:[e.jsx(re,{})," Edit"]})}),le(D,["delete_roles"],B)&&e.jsx(l.Tooltip,{content:"Delete Role",children:e.jsxs(l.Button,{size:"sm",variant:"text",className:"flex items-center gap-1 text-red-500 p-1",onClick:()=>{K(s)},children:[e.jsx(ce,{})," Delete"]})})]})})]},s)})})]}),h.length===0&&e.jsx("div",{className:"text-center py-6",children:e.jsx(l.Typography,{className:"font-medium font-poppins",children:"No roles found"})})]})})})]}),e.jsx($,{show:M,onClose:R,maxWidth:"3xl",children:e.jsxs("div",{className:"delete-modal px-6 py-8 relative font-poppins",children:[e.jsxs("h1",{className:"font-bold text-2xl font-poppins",children:[I," Role"]}),e.jsx("div",{className:"absolute -top-8 -right-8 text-white cursor-pointer",children:e.jsx(A,{strokeWidth:1.5,size:38,onClick:R})}),e.jsx("div",{className:"modal-content pt-6",children:e.jsxs("form",{onSubmit:J,children:[e.jsxs("div",{className:"form-item mb-8",children:[e.jsx(N,{value:"Role Name",className:"mb-1 font-poppins font-semibold"}),e.jsx(ie,{id:"name",type:"text",name:"name",className:"w-full rounded-md font-poppins",placeholder:"Role Name...",value:r.name,onChange:s=>d("name",s.target.value),disabled:m==="_view"}),e.jsx(te,{message:U.name,className:"mt-2"})]}),e.jsxs("div",{className:"form-item mb-8",children:[e.jsxs("div",{className:"border-b pb-2 mb-4",children:[e.jsx(N,{value:"Permissions",className:"text-lg font-poppins font-semibold"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Assign permissions to this role to control access to different features"})]}),e.jsx("div",{className:"permission-wrapper space-y-6",children:j.map(({name:s,items:o},i)=>e.jsxs("div",{className:"permission-category bg-gray-50 p-4 rounded-md",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(T,{className:"w-5 h-5 mr-2 focus:ring-yellow-500 text-yellow-500",id:`category-${s}`,checked:X(s),indeterminate:q(s),onChange:t=>H(s,t.target.checked),disabled:m==="_view"}),e.jsx(N,{htmlFor:`category-${s}`,value:s,className:"text-lg font-poppins font-medium cursor-pointer"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3 ml-7",children:o.map((t,a)=>{const n=`${t}_${s.toLowerCase().replace(/ /g,"_")}`;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{id:`permission-${n}`,className:"w-4 h-4 mr-2 focus:ring-yellow-500 text-yellow-500",value:n,onChange:c=>G(c),checked:r.permissions.includes(n),disabled:m==="_view"}),e.jsx(N,{htmlFor:`permission-${n}`,value:t.charAt(0).toUpperCase()+t.slice(1),className:"text-sm font-poppins cursor-pointer"})]},a)})})]},i))})]}),m!=="_view"&&e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx(l.Button,{variant:"outlined",color:"red",onClick:R,className:"normal-case",children:"Cancel"}),e.jsx(l.Button,{type:"submit",className:"bg-[#f5cd06] text-[#0f0f0f] normal-case",disabled:S,children:S?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l.Spinner,{className:"h-4 w-4"})," Processing..."]}):"Save Role"})]})]})})]})}),e.jsx($,{show:F,onClose:g,maxWidth:"xl",children:e.jsxs("div",{className:"delete-modal px-6 py-8 relative font-poppins",children:[e.jsx("h1",{className:"font-bold text-2xl text-center",children:"Confirm Role Deletion"}),e.jsx("p",{className:"text-center text-gray-600 mt-4",children:"Are you sure you want to delete this role? Users with this role will be assigned to the 'guest' role."}),e.jsx("div",{className:"absolute -top-8 -right-8 text-white cursor-pointer",children:e.jsx(A,{strokeWidth:1.5,size:38,onClick:g})}),e.jsxs("div",{className:"flex justify-center gap-4 pt-6",children:[e.jsx(l.Button,{variant:"outlined",color:"gray",onClick:g,className:"normal-case",children:"Cancel"}),e.jsx(l.Button,{variant:"filled",color:"red",onClick:Q,className:"normal-case",children:"Delete Role"})]})]})})]})}export{_e as default};
