import{X as Te,G as Pe,r as l,j as e,S as Be,x as ne,A as De,c as ie}from"./app-eKKndjnY.js";import{A as Re,i as Me}from"./AuthenticatedLayout-jI0e412N.js";import{r as t}from"./index-XA5Fpi3v.js";import{M as ce}from"./Modal-C5Eq79CS.js";import{e as Ie,f as de,g as ze,c as Oe,d as We,h as He,R as me}from"./index-DffKeYjJ.js";import{I as n}from"./InputLabel-75kjOZUe.js";import{I as x}from"./InputError-B7yvwPX_.js";import{T as h}from"./TextInput-Cqw5La3c.js";import{O as Ve,V as i}from"./index-DOdrVWTX.js";import"./index-Be1TB9th.js";import"./iconBase-Dljp4mII.js";import"./Dropdown-D_xPmhC-.js";import"./transition-BNarjejl.js";import"./index-BarBPuyi.js";import"./index-DvKDCjWq.js";import"./keyboard-VLzb7i-w.js";function cs({auth:k,users_list:z,locale:U,roles:O}){const{role:pe,permissions:xe}=Te().props.auth,T=["SN","First Name","Last Name","Email","Phone","Locale","Role","Actions","Status"],{data:m,setData:c,post:W,processing:H,errors:p,reset:y,delete:qe}=Pe({first_name:"",last_name:"",email:"",phone:"",password:"",password_confirmation:"",local:"",role:""}),[ue,b]=l.useState(!1),[he,V]=l.useState(""),[w,q]=l.useState(""),[P,G]=l.useState(""),[fe,X]=l.useState(!1),[J,K]=l.useState(!1),[f,Q]=l.useState(""),[j,Y]=l.useState(""),[g,Z]=l.useState(""),[$,je]=l.useState(!1),[S,ge]=l.useState("first_name"),[C,Ne]=l.useState("asc"),[ve,ee]=l.useState(!1),[u,ye]=l.useState(1),[_]=l.useState(10),[se,be]=l.useState([]),[A,N]=l.useState([]);l.useEffect(()=>{be(z),N(z)},[]);const B=(s,a,o)=>[...s].sort((r,v)=>{if(a==="local"){const F=D(r.local)||"",E=D(v.local)||"";return o==="asc"?F.localeCompare(E):E.localeCompare(F)}return r[a]<v[a]?o==="asc"?-1:1:r[a]>v[a]?o==="asc"?1:-1:0}),we=s=>{const a=s===S&&C==="asc"?"desc":"asc";ge(s),Ne(a),N(B(A,s,a))},D=s=>{if(s){const a=U.filter(o=>o.id===parseInt(s));if(a.length)return a[0].title}return""},Se=s=>s&&s.length>0?s[0].name:"guest",ae=(s,a=0)=>{if(a!==0&&G(a),s==="add")V("Add New"),q("_add"),y();else if(s==="edit"){const o=se.filter(r=>r.id===a);c({...o[0],role:o[0].roles&&o[0].roles[0]?o[0].roles[0].name:"guest",password:"",password_confirmation:""}),V("Edit"),q("_edit")}b(!0)},R=()=>{b(!1),y()},Ce=s=>{s.preventDefault(),w==="_add"?W(route("admin.users.store"),{preserveScroll:!0,onSuccess:()=>{y(),b(!1),i.success("User created successfully!")},onError:()=>{i.error("Failed to create user. Please check the form for errors.")}}):w==="_edit"&&W(route("admin.users.update",P),{onSuccess:()=>{y(),b(!1),i.success("User updated successfully!")},onError:()=>{i.error("Failed to update user. Please check the form for errors.")}})},_e=s=>{G(s),X(!0)},L=()=>{X(!1)},Ae=()=>{P&&De.delete(route("admin.users.delete",P),{onSuccess:()=>{L(),i.success("User deleted successfully!")},onError:()=>{i.error("Failed to delete user.")}})},Le=async()=>{ee(!0);try{if(f.length>=3||j||g){const s=await ie.post(route("admin.search.user"),{search_query:f,search_locale:j,search_role:g});s!=null&&s.data&&N(B(s.data,S,C))}else N(B(se,S,C))}catch{i.error("Error searching users")}finally{ee(!1)}};l.useEffect(()=>{const s=setTimeout(()=>{Le()},500);return()=>clearTimeout(s)},[f,j,g]);const Fe=async s=>{var a,o;K(!0);try{if(s){const r=await ie.post(route("admin.users.approval"),{id:s});r.status===200?(N((a=r==null?void 0:r.data)==null?void 0:a.users),i.success(((o=r==null?void 0:r.data)==null?void 0:o.message)||"User approved successfully!")):i.error("Failed to approve user.")}}catch{i.error("Error approving user")}finally{K(!1)}},Ee=()=>{Q(""),Y(""),Z("")},te=u*_,le=te-_,M=A.slice(le,te),re=Math.ceil(A.length/_),I=s=>ye(s);return e.jsxs(Re,{user:k==null?void 0:k.user,children:[e.jsx(Be,{title:"Users"}),e.jsx(Ve,{position:"top-right"}),e.jsxs("div",{className:"content py-4 font-poppins",children:[e.jsxs("div",{className:"content-header px-6 flex justify-between items-center",children:[e.jsxs("div",{className:"left",children:[e.jsx("h1",{className:"font-semibold text-gray-800 text-3xl",children:"User Management"}),e.jsx("div",{className:"pt-2",children:e.jsxs("ul",{className:"flex gap-1 text-gray-600 text-sm",children:[e.jsx("li",{children:e.jsx(ne,{href:route("dashboard"),children:"Dashboard"})}),e.jsx("li",{children:"/"}),e.jsx("li",{children:e.jsx(ne,{href:route("admin.users.index"),children:"Users"})})]})})]}),e.jsx("div",{className:"right",children:e.jsx(t.Button,{className:"bg-[#f5cd06] shadow-lg text-[#0f0f0f] px-5 py-3 rounded-md font-semibold text-lg font-poppins normal-case flex items-center gap-2",onClick:()=>{ae("add")},children:e.jsx("span",{children:"Add New User"})})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md mx-6 mt-6 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(h,{type:"text",placeholder:"Search by name, email, phone...",className:"rounded border-gray-400/80 w-full focus:ring-yellow-500 focus:border-yellow-500",value:f,onChange:s=>{Q(s.target.value)}})}),e.jsxs(t.Button,{variant:"outlined",className:"flex items-center gap-2 border-gray-300 text-gray-700",onClick:()=>je(!$),children:[e.jsx(Ie,{})," Filters"]}),(f||j||g)&&e.jsx(t.Button,{variant:"text",className:"text-red-500",onClick:Ee,children:"Clear Filters"})]}),$&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 p-4 bg-gray-50 rounded-md",children:[e.jsxs("div",{children:[e.jsx(n,{value:"Filter by Locale",className:"mb-1"}),e.jsxs("select",{className:"border-gray-300 focus:border-yellow-500 focus:ring-yellow-500 rounded-md shadow-sm w-full",value:j,onChange:s=>Y(s.target.value),children:[e.jsx("option",{value:"",children:"All Locales"}),U.map(({id:s,title:a})=>e.jsx("option",{value:s,children:a},s))]})]}),e.jsxs("div",{children:[e.jsx(n,{value:"Filter by Role",className:"mb-1"}),e.jsxs("select",{className:"border-gray-300 focus:border-yellow-500 focus:ring-yellow-500 rounded-md shadow-sm w-full",value:g,onChange:s=>Z(s.target.value),children:[e.jsx("option",{value:"",children:"All Roles"}),O.map(({id:s,name:a})=>e.jsx("option",{value:a,children:a},s))]})]})]}),e.jsx("div",{className:"rounded-lg overflow-hidden border border-gray-200",children:e.jsxs("table",{className:"w-full min-w-max table-auto text-left font-poppins",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50",children:T.map(s=>e.jsx("th",{className:"border-b border-blue-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.Typography,{className:"font-semibold text-sm leading-none opacity-70 font-poppins",children:s}),s!=="SN"&&s!=="Actions"&&s!=="Status"&&e.jsx("button",{onClick:()=>we(s.toLowerCase().replace(" ","_")),className:"text-gray-500 hover:text-yellow-600 transition-colors",children:S===s.toLowerCase().replace(" ","_")?C==="asc"?e.jsx(de,{}):e.jsx(ze,{}):e.jsx(de,{className:"opacity-40"})})]})},s))})}),e.jsx("tbody",{children:ve?e.jsx("tr",{children:e.jsx("td",{colSpan:T.length,className:"p-8 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(t.Spinner,{className:"h-8 w-8",color:"amber"})})})}):M.length>0?M.map(({id:s,first_name:a,last_name:o,email:r,local:v,phone:F,roles:E,admin_approved:ke},oe)=>{const d=oe===M.length-1?"p-4":"p-4 border-b border-blue-gray-50",Ue=le+oe+1;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:d,children:e.jsx(t.Typography,{className:"font-medium font-poppins text-sm",children:Ue})}),e.jsx("td",{className:d,children:e.jsx(t.Typography,{className:"font-medium font-poppins text-sm",children:a})}),e.jsx("td",{className:d,children:e.jsx(t.Typography,{className:"font-medium font-poppins text-sm",children:o})}),e.jsx("td",{className:d,children:e.jsx(t.Typography,{className:"font-medium font-poppins text-sm",children:r})}),e.jsx("td",{className:d,children:e.jsx(t.Typography,{className:"font-medium font-poppins text-sm",children:F})}),e.jsx("td",{className:d,children:e.jsx(t.Typography,{className:"font-medium font-poppins text-sm",children:D(v)})}),e.jsx("td",{className:d,children:e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:Se(E)})}),e.jsx("td",{className:d,children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t.Button,{size:"sm",variant:"text",className:"flex items-center gap-1 text-blue-500 p-1",onClick:()=>{ae("edit",s)},children:[e.jsx(Oe,{})," Edit"]}),Me(xe,["delete_users"],pe)&&e.jsxs(t.Button,{size:"sm",variant:"text",className:"flex items-center gap-1 text-red-500 p-1",onClick:()=>{_e(s)},children:[e.jsx(We,{})," Delete"]})]})}),e.jsx("td",{className:d,children:ke===0?e.jsx(t.Button,{size:"sm",variant:"filled",color:"green",className:"flex items-center gap-1 bg-green-600 text-white normal-case",onClick:()=>{Fe(s)},disabled:J,children:J?e.jsx(t.Spinner,{className:"h-4 w-4"}):e.jsxs(e.Fragment,{children:[e.jsx(He,{})," Approve"]})}):e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium",children:"Approved"})})]},s)}):e.jsx("tr",{children:e.jsx("td",{colSpan:T.length,className:"p-4 text-center",children:e.jsx(t.Typography,{className:"font-medium font-poppins",children:"No users found"})})})})]})}),A.length>_&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t.Button,{size:"sm",variant:"outlined",disabled:u===1,onClick:()=>I(u-1),children:"Previous"}),Array.from({length:re},(s,a)=>e.jsx(t.Button,{size:"sm",variant:u===a+1?"filled":"text",className:u===a+1?"bg-yellow-500":"",onClick:()=>I(a+1),children:a+1},a)),e.jsx(t.Button,{size:"sm",variant:"outlined",disabled:u===re,onClick:()=>I(u+1),children:"Next"})]})})]})]}),e.jsx(ce,{show:ue,onClose:R,maxWidth:"2xl",children:e.jsxs("div",{className:"delete-modal px-6 py-8 relative font-poppins",children:[e.jsxs("h1",{className:"font-bold text-2xl font-poppins",children:[he," User"]}),e.jsx("div",{className:"absolute -top-8 -right-8 text-white cursor-pointer",children:e.jsx(me,{strokeWidth:1.5,size:38,onClick:R})}),e.jsx("div",{className:"modal-content pt-6",children:e.jsxs("form",{onSubmit:Ce,children:[e.jsx("div",{className:"form-item mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{value:"First Name",className:"mb-1 font-poppins font-semibold"}),e.jsx(h,{id:"first_name",type:"text",name:"first_name",className:"w-full rounded-md font-poppins",placeholder:"First Name...",value:m.first_name,onChange:s=>c("first_name",s.target.value)}),e.jsx(x,{message:p.first_name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{value:"Last Name",className:"mb-1 font-poppins font-semibold"}),e.jsx(h,{id:"last_name",type:"text",name:"last_name",className:"w-full rounded-md font-poppins",placeholder:"Last Name...",value:m.last_name,onChange:s=>c("last_name",s.target.value)}),e.jsx(x,{message:p.last_name,className:"mt-2"})]})]})}),e.jsx("div",{className:"form-item mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{value:"Email",className:"mb-1 font-poppins font-semibold"}),e.jsx(h,{id:"email",type:"email",name:"email",className:"w-full rounded-md font-poppins",placeholder:"Email Address...",value:m.email,onChange:s=>c("email",s.target.value),readOnly:w==="_edit"}),e.jsx(x,{message:p.email,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{value:"Phone",className:"mb-1 font-poppins font-semibold"}),e.jsx(h,{id:"phone",type:"text",name:"phone",className:"w-full rounded-md font-poppins",placeholder:"Phone Number...",value:m.phone,onChange:s=>c("phone",s.target.value)}),e.jsx(x,{message:p.phone,className:"mt-2"})]})]})}),e.jsx("div",{className:"form-item mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{value:"Password",className:"mb-1 font-poppins font-semibold"}),e.jsx(h,{id:"password",type:"password",name:"password",className:"w-full rounded-md font-poppins",placeholder:w==="_edit"?"Leave blank to keep current password":"Password...",value:m.password,onChange:s=>c("password",s.target.value)}),e.jsx(x,{message:p.password,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{value:"Confirm Password",className:"mb-1 font-poppins font-semibold"}),e.jsx(h,{id:"password_confirmation",type:"password",name:"password_confirmation",className:"w-full rounded-md font-poppins",placeholder:"Confirm Password...",value:m.password_confirmation,onChange:s=>c("password_confirmation",s.target.value)}),e.jsx(x,{message:p.password_confirmation,className:"mt-2"})]})]})}),e.jsx("div",{className:"form-item mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{value:"Locale",className:"mb-1 font-poppins font-semibold"}),e.jsxs("select",{name:"local",className:"border-gray-300 focus:border-yellow-500 focus:ring-yellow-500 rounded-md shadow-sm w-full",value:m.local,onChange:s=>c("local",s.target.value),children:[e.jsx("option",{value:"",children:"Select Locale"}),U.map(({id:s,title:a})=>e.jsx("option",{value:s,children:a},s))]}),e.jsx(x,{message:p.local,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{value:"Role",className:"mb-1 font-poppins font-semibold"}),e.jsxs("select",{name:"role",className:"border-gray-300 focus:border-yellow-500 focus:ring-yellow-500 rounded-md shadow-sm w-full",value:m.role,onChange:s=>c("role",s.target.value),children:[e.jsx("option",{value:"",children:"Select Role"}),O.map(({id:s,name:a})=>e.jsx("option",{value:a,children:a},s))]}),e.jsx(x,{message:p.role,className:"mt-2"})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx(t.Button,{variant:"outlined",color:"red",onClick:R,className:"normal-case",children:"Cancel"}),e.jsx(t.Button,{type:"submit",className:"bg-[#f5cd06] text-[#0f0f0f] normal-case",disabled:H,children:H?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.Spinner,{className:"h-4 w-4"})," Processing..."]}):"Save User"})]})]})})]})}),e.jsx(ce,{show:fe,onClose:L,maxWidth:"xl",children:e.jsxs("div",{className:"delete-modal px-6 py-8 relative font-poppins",children:[e.jsx("h1",{className:"font-bold text-2xl text-center",children:"Confirm User Deletion"}),e.jsx("p",{className:"text-center text-gray-600 mt-4",children:"Are you sure you want to delete this user? This action cannot be undone."}),e.jsx("div",{className:"absolute -top-8 -right-8 text-white cursor-pointer",children:e.jsx(me,{strokeWidth:1.5,size:38,onClick:L})}),e.jsxs("div",{className:"flex justify-center gap-4 pt-6",children:[e.jsx(t.Button,{variant:"outlined",color:"gray",onClick:L,className:"normal-case",children:"Cancel"}),e.jsx(t.Button,{variant:"filled",color:"red",onClick:Ae,className:"normal-case",children:"Delete User"})]})]})})]})}export{cs as default};
