import{X as ne,r,j as e,S as le,x as ie,A as oe}from"./app-CZB67pLA.js";import{M as ce}from"./Modal-CMvdT5Wb.js";import"./TextInput-D_I-lbPe.js";import{G as de}from"./GuestLayout-CP-XezDA.js";import{k as me,ag as U,q as ue,E as xe,n as ge,af as L,o as he,ad as Q,ae as fe,m as pe,j as be}from"./index-Bc1sA33s.js";import{q as ye}from"./index-4vUVBD-h.js";import"./index-Bqnb2d41.js";import{B as Y}from"./Badge-CH-5IrWk.js";import"./Card-CwiT9xHf.js";import{r as B}from"./index-DBc7mDRn.js";import{f as w}from"./index-Dw_W2KWe.js";import"./transition-BI-e7dbj.js";import"./keyboard-CPVUawMx.js";import"./Dropdown-Cq0s5oFs.js";import"./iconBase-x3SJZAWa.js";import"./index-BykJh5iJ.js";import"./index-BarBPuyi.js";function Ue({auth:je,events:V,locale:Ne,flash:j,eventTypes:g,internalCategories:C,externalCategories:k,isAuthenticated:n,userData:l}){ne().props;const[X,S]=r.useState(!1),[E,i]=r.useState((j==null?void 0:j.message)||""),[M,c]=r.useState("success"),[b,F]=r.useState(null),[m,u]=r.useState([]),[O,N]=r.useState(!1),[R,q]=r.useState(!1),[z,ve]=r.useState("in-person"),[h,v]=r.useState(V),[y,D]=r.useState("all"),[f,J]=r.useState("all"),[P,T]=r.useState(!1);r.useMemo(()=>{const s=new Set(["all"]);return h.forEach(t=>{t.category&&s.add(t.category)}),Array.from(s)},[h]);const A=r.useMemo(()=>h.filter(s=>{const t=y==="all"||s.category===y,a=f==="all"||f===g.internal&&s.is_internal||f===g.external&&s.is_external;return t&&a}),[h,y,f,g]);r.useEffect(()=>{u(l&&n?[{id:p(),name:l.name,email:l.email,phone:l.phone||"",locale:l.locale||"",attendee_type:"member",attendance_mode:"in-person"}]:[{id:p(),name:"",email:"",phone:"",locale:"",attendee_type:"guest",attendance_mode:"in-person"}])},[l,n]);const K=async()=>{T(!0);try{const t=await(await fetch(route("events.data"))).json();t.events&&v(t.events)}catch(s){console.error("Error fetching events data:",s),i("Failed to refresh events data"),c("error")}finally{T(!1)}},p=function(s=6){return Math.random().toString(36).substring(2,s+2)},W=()=>{u([...m,{id:p(),name:"",email:"",phone:"",locale:"",attendee_type:"guest",attendance_mode:"in-person"}])},H=s=>{u(m.filter(t=>t.id!==s))},I=s=>{const t=h.find(a=>a.id===s);if(t){if(F(t),n&&t.is_internal&&!t.requires_registration){Z(t);return}if(t.is_internal&&!n){window.location.href=route("login");return}if(t.has_attended){i("You have already registered for this event"),c("info");return}if(t.max_attendees&&t.attendances_count>=t.max_attendees){i("This event has reached its maximum capacity"),c("error");return}S(!0)}},Z=async s=>{if(!n){i("You must be logged in to check in"),c("error");return}if(s.has_attended){i("You have already checked in to this event"),c("info");return}q(!0);try{const a=await(await fetch(route("event.quick.check.in"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({event_id:s.id,attendance_mode:z})})).json();a.success?(i(a.message),c("success"),v(d=>d.map(o=>o.id===s.id?{...o,has_attended:!0,attendances_count:o.attendances_count+1}:o))):(i(a.message||"Failed to check in. Please try again."),c("error"))}catch(t){console.error("Error during quick check-in:",t),i("An error occurred during check-in. Please try again."),c("error")}finally{q(!1)}},_=()=>{S(!1),F(null),u(l&&n?[{id:p(),name:l.name,email:l.email,phone:l.phone||"",locale:l.locale||"",attendee_type:"member",attendance_mode:"in-person"}]:[{id:p(),name:"",email:"",phone:"",locale:"",attendee_type:"guest",attendance_mode:"in-person"}])},x=(s,t,a)=>{u(m.map(d=>d.id===s?{...d,[t]:a}:d))},ee=()=>{let s=!0;return m.forEach(t=>{(!t.name||!t.email||!t.phone||!t.locale)&&(s=!1),t.email&&!/\S+@\S+\.\S+/.test(t.email)&&(s=!1)}),s},se=async s=>{if(s.preventDefault(),!ee()){alert("Please fill in all required fields with valid information.");return}N(!0);try{await oe.post(route("event.attendence.store"),{event_id:b.id,attendenceRows:m}),N(!1),_(),i("Successfully registered for the event!"),c("success"),v(t=>t.map(a=>a.id===b.id?{...a,has_attended:n,attendances_count:a.attendances_count+m.length}:a))}catch(t){N(!1),console.error("Error registering attendance:",t),i("Failed to register attendance. Please try again."),c("error")}},te=async s=>{const t=route("events.share",s.id);if(navigator.share)try{await navigator.share({title:s.title,text:s.description,url:t})}catch(a){a.name!=="AbortError"&&(console.error("Error sharing:",a),$(t))}else $(t)},$=s=>{navigator.clipboard.writeText(s).then(()=>{alert("Link copied to clipboard!")}).catch(t=>{console.error("Failed to copy: ",t)})};function ae(s,t){const a=new Date(s),d=new Date(t);return`${w(a,"MMM d, yyyy")} • ${w(a,"h:mm a")} - ${w(d,"h:mm a")}`}const re=s=>s?{...C,...k}[s]||s.replace("_"," "):"";return e.jsxs(de,{children:[e.jsx(le,{title:"Church Events"}),E&&e.jsxs("div",{className:`fixed top-20 right-4 z-50 w-80 p-4 rounded-lg shadow-lg transition-opacity duration-500 
                    ${M==="success"?"bg-green-500":M==="error"?"bg-red-500":"bg-blue-500"} text-white`,children:[e.jsx("p",{children:E}),e.jsx("button",{className:"absolute top-2 right-2 text-white",onClick:()=>i(""),children:"×"})]}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Church Events"}),e.jsxs("div",{className:"mb-8 flex flex-wrap gap-4",children:[e.jsx("div",{className:"w-full md:w-auto",children:e.jsxs("select",{value:y,onChange:s=>D(s.target.value),className:"w-full md:w-auto px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Categories"}),Object.entries({...C,...k}).map(([s,t])=>e.jsx("option",{value:s,children:t},s))]})}),e.jsx("div",{className:"w-full md:w-auto",children:e.jsxs("select",{value:f,onChange:s=>J(s.target.value),className:"w-full md:w-auto px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Event Types"}),e.jsx("option",{value:g.internal,children:"Members Only"}),e.jsx("option",{value:g.external,children:"Open to Guests"})]})}),e.jsx("button",{onClick:K,className:"w-full md:w-auto px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center justify-center",disabled:P,children:P?e.jsxs("span",{className:"flex items-center",children:[e.jsx(B.Spinner,{className:"h-4 w-4 mr-2"}),"Refreshing..."]}):e.jsxs("span",{className:"flex items-center",children:[e.jsx(me,{className:"mr-2"}),"Refresh Events"]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:A.length>0?A.map(s=>{const t=new Date,a=new Date(s.start_date),d=new Date(s.end_date);let o,G=!1;return t<a?(o="Upcoming",G=!0):t>=a&&t<=d?o="Ongoing":o="Past",e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden border border-gray-200 flex flex-col",children:[s.featured_image?e.jsx("div",{className:"h-48 bg-cover bg-center",style:{backgroundImage:`url(${s.featured_image})`}}):e.jsx("div",{className:"h-48 bg-gray-200 flex items-center justify-center",children:e.jsx(U,{className:"text-gray-400 h-16 w-16"})}),e.jsxs("div",{className:"p-4 flex-grow",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx(Y,{color:s.is_internal?"blue":"green",className:"text-xs",children:s.is_internal?"Members Only":"Open to Guests"}),e.jsx(Y,{color:o==="Upcoming"?"blue":o==="Ongoing"?"green":"gray",className:"text-xs",children:o})]}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:[e.jsx(ye,{className:"inline mr-1"}),re(s.category)]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(ue,{className:"text-blue-500 mt-1 mr-2"}),e.jsx("span",{className:"text-sm",children:ae(s.start_date,s.end_date)})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(xe,{className:"text-blue-500 mt-1 mr-2"}),e.jsx("span",{className:"text-sm",children:s.location})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ge,{className:"text-blue-500 mt-1 mr-2"}),e.jsxs("span",{className:"text-sm",children:[s.attendances_count," registered",s.max_attendees>0&&` (max: ${s.max_attendees})`]})]})]})]}),e.jsxs("div",{className:"px-4 pb-4 pt-0 mt-auto",children:[s.has_attended&&e.jsxs("div",{className:"mb-2 text-center text-sm text-green-600 flex items-center justify-center",children:[e.jsx(L,{className:"mr-1"}),"You're registered for this event"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(ie,{href:route("events.show",s.id),className:"flex-1 px-4 py-2 text-center bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center justify-center",children:[e.jsx(he,{className:"mr-2"}),"View Details"]}),G&&!s.has_attended&&e.jsx(e.Fragment,{children:n&&s.is_internal&&!s.requires_registration?e.jsxs("button",{onClick:()=>I(s.id),disabled:R,className:"flex-1 px-4 py-2 text-center bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center justify-center",children:[e.jsx(Q,{className:"mr-2"}),R?"Checking in...":"Quick Check-in"]}):s.requires_registration&&e.jsxs("button",{onClick:()=>I(s.id),className:"flex-1 px-4 py-2 text-center bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center justify-center",children:[e.jsx(Q,{className:"mr-2"}),"Register"]})}),e.jsx("button",{onClick:()=>te(s),className:"w-10 px-0 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 flex items-center justify-center",children:e.jsx(fe,{})})]})]})]},s.id)}):e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx(U,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No events found"}),e.jsx("p",{className:"text-gray-500",children:"Try changing your filters or check back later for upcoming events."})]})})]})})}),e.jsx(ce,{show:X,onClose:_,maxWidth:"md",children:b&&e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4",children:["Register for: ",b.title]}),e.jsxs("form",{onSubmit:se,children:[m.map((s,t)=>e.jsxs("div",{className:"mb-6 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h3",{className:"text-md font-semibold",children:["Attendee #",t+1]}),m.length>1&&e.jsx("button",{type:"button",onClick:()=>H(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(pe,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name*"}),e.jsx("input",{type:"text",value:s.name,onChange:a=>x(s.id,"name",a.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",required:!0,readOnly:n&&s.attendee_type==="member"&&t===0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email*"}),e.jsx("input",{type:"email",value:s.email,onChange:a=>x(s.id,"email",a.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",required:!0,readOnly:n&&s.attendee_type==="member"&&t===0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone*"}),e.jsx("input",{type:"tel",value:s.phone,onChange:a=>x(s.id,"phone",a.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",required:!0,readOnly:n&&s.attendee_type==="member"&&t===0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Locale/Region*"}),e.jsx("input",{type:"text",value:s.locale,onChange:a=>x(s.id,"locale",a.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",required:!0,readOnly:n&&s.attendee_type==="member"&&t===0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Attendee Type"}),e.jsxs("select",{value:s.attendee_type,onChange:a=>x(s.id,"attendee_type",a.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",disabled:n&&t===0,children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"guest",children:"Guest"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Attendance Mode"}),e.jsxs("select",{value:s.attendance_mode,onChange:a=>x(s.id,"attendance_mode",a.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"in-person",children:"In-Person"}),e.jsx("option",{value:"online",children:"Online"})]})]})]})]},s.id)),e.jsx("div",{className:"mb-4",children:e.jsxs("button",{type:"button",onClick:W,className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(be,{className:"mr-1"})," Add Another Attendee"]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:_,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 flex items-center",disabled:O,children:O?e.jsxs(e.Fragment,{children:[e.jsx(B.Spinner,{className:"mr-2 h-4 w-4"})," Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2"})," Submit"]})})]})]})]})})]})}export{Ue as default};
